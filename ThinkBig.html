<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThinkBIG</title>
    <style>
        #wrapper {
            width: 1100px;
            height: 900px;
            margin: auto;
            background: whitesmoke;
        }

        #content {
            width: 900px;
            height: 100%;
            float: left;
            background: whitesmoke;
            position: relative;
        }

        #pic {
            width: 100%;
            height: 100%;
        }

        #side {
            width: 200px;
            height: 100%;
            float: left;
            background: lemonchiffon;
            text-align: center;
            box-sizing: border-box;
            position: relative;
        }

        #score {
            width: 90%;
            font-size: 40px;
            font-weight: bold;
            margin-top: 30px;
        }

        #side input {
            width: 90%;
            height: 50px;
            font-size: 40px;
            margin-top: 30px;
        }

        #side h1 {
            width: 90%;
            margin-top: 30px;
        }

        #side img {
            width: 35px;
            height: 35px;
        }

        #start_bt {
            width: 50%;
            height: 35px;
            margin-top: 20px;
            border-radius: 20%;
            background: lavender;
        }

        #game_theme1 {
            width: 80%;
            margin-top: 40px;
        }

        #game_theme2 {
            width: 80%;
            margin-top: 10px;
        }

        #timer {
            width: 50%;
            font-size: 45px;
            text-align: center;
            margin-top: 30px;
        }
    </style>
    <script src="./Box.js"></script>
    <script>
        let content;
        let side;
        let score;
        let input;
        let stage;
        let timer;
        let boxArray = [];
        let secondBoxArray = [];
        let thirdBoxArray = [];
        let indexX = 0; //배열을 접근하기 위한 호수
        let indexY = 0; //배열을 접근하기 위한 층수
        let n = -1;
        let s = 0;
        let t = 10;
        let sec = 31;
        let st;
        let imgArray = [];
        let foodArray = [
            ["./images/food/pancake.jpg", "팬케이크"],
            ["./images/food/hamburger.jpg", "햄버거"],
            ["./images/food/ramen.jpg", "라멘"],
            ["./images/food/potato.jpg", "감자튀김"],
            ["./images/food/sushi.jpg", "초밥"],
            ["./images/food/chickensoup.jpg", "삼계탕"],
            ["./images/food/tteokbokki.jpg", "떡볶이"],
            ["./images/food/coldnoodle.jpg", "냉면"],
            ["./images/food/hotteok.jpg", "호떡"],
            ["./images/food/pizza.jpg", "피자"]
        ];


        function setScore() {
            s += 10;
            score.innerText = s + "점";
        }

        function checkAnswer() {
            if (input.value == foodArray[n][1]) {
                input.value = "";
                setScore();
                t--;
                imgArray[t].style.transform = "rotate(75deg)";
                killTimeOut();
                createGameContent();
                next();
            } else {
                input.value = "";
                input.focus();
            }

        }

        function move() {
            let box = boxArray[indexY][indexX];
            box.showHide();
        }

        function removeArray() {
            for (let a = 0; a < boxArray.length; a++) {
                for (let i = 0; i < boxArray[a].length; i++) {
                    content.removeChild(boxArray[a][i].div);
                }
            }
        }

        //이미지 붙이기
        function createGameContent() {
            //(container, src)
            n++;
            pic.src = foodArray[n][0];

            if (n > 3 && n <= 6) {
                if (n == 4) {
                    alert("Stage1 클리어!");
                }
                stage.innerText = "Stage" + 2;
                removeArray();
                boxArray.length = 0;
                createSecondBox();
            } else if (n > 6 && n <= 9) {
                if (n == 7) {
                    alert("Stage2 클리어!");
                }
                stage.innerText = "Stage" + 3;
                removeArray();
                boxArray.length = 0;
                createThirdBox();
            } else if (n > 9) {
                removeArray();
                boxArray.length = 0;
                pic.src = "./images/stageclear.jpg";
            }
        }

        //덮어 씌울 셀 아홉개 만들기
        function createFirstBox() {
            for (let a = 0; a < 3; a++) {
                let arr = new Array(3);
                for (let i = 0; i < arr.length; i++) {
                    //(container, width, height, x, y)
                    let box = new Box(content, 300, 300, i * 300, a * 300);
                    arr[i] = box;
                }
                boxArray.push(arr);
            }
        }

        function createSecondBox() {
            for (let a = 0; a < 4; a++) {
                let arr = new Array(4);
                for (let i = 0; i < arr.length; i++) {
                    let box = new Box(content, 225, 225, i * 225, a * 225);
                    arr[i] = box;
                }
                boxArray.push(arr);
            }
        }

        function createThirdBox() {
            for (let a = 0; a < 5; a++) {
                let arr = new Array(5);
                for (let i = 0; i < arr.length; i++) {
                    let box = new Box(content, 180, 180, i * 180, a * 180);
                    arr[i] = box;
                }
                boxArray.push(arr);
            }
        }

        //타임아웃이 시작되는 경우
        //1) 스타트 버튼 눌렀을때
        //2) 답을 맞췄을 때
        //3) 30초가 종료되고 다음 문제 나오기 직전.
        function next() {
            st = setInterval("timeCheck()", 1000);
            setPosX(indexX);
            setPosY(indexY);
            move();
        }


        function setPosX(x) {
            //indexX는 호수를 넘어설 수 없다.
            if ((indexX + x) <= boxArray[0].length - 1) {
                indexX += x;
            }
            if ((indexX + x) < 0) {
                indexX = 0;
            }
            console.log(indexX, indexY);
        }

        function setPosY(y) {
            //indexY는 층수를 넘어설 수 없다.
            if ((indexY + y) <= boxArray.length - 1) {
                indexY += y;
            }
            if ((indexY + y) < 0) {
                indexY = 0;
            }
            console.log(indexX, indexY);

        }

        //setInt() 종료시켜야하는 경우
        //1) 문제를 맞췄을 때
        //2) 타임아웃 되면
        function killTimeOut() {
            clearTimeout(st);
            sec = 30;
        }

        function timeCheck() {
            sec--;
            timer = document.getElementById("timer");
            timer.innerText = sec;
            if(sec<=0){
                killTimeOut();
            }
        }

        function start() {
            next();
        }

        function init() {
            content = document.getElementById("content");
            side = document.getElementById("side");
            input = document.querySelector("input");
            score = document.getElementById("score");
            stage = document.querySelector("h1");
            imgArray = document.querySelectorAll("#side img");
        }

        addEventListener("load", function () {
            init();
            createGameContent();
            createFirstBox();


            //버튼을 누르면, 배열의 다음 div의 style.opacity가 0으로.
            document.body.addEventListener("keydown", function (e) {
                switch (e.keyCode) {
                    case 37: setPosX(-1); break;
                    case 39: setPosX(1); break;
                    case 38: setPosY(-1); break;
                    case 40: setPosY(1); break;
                }
                move();
            });
            input.addEventListener("keydown", function (e) {
                if (e.keyCode == 13) {
                    checkAnswer();
                }
            });

        });
    </script>
</head>

<body>
    <div id="wrapper">
        <div id="content">
            <img id="pic">
        </div>
        <div id="side">
            <div id="score">00점</div>
            <h1>Stage1</h1>
            <img src="./images/pin.png"></br>
            <img src="./images/pin.png"><img src="./images/pin.png"></br>
            <img src="./images/pin.png"><img src="./images/pin.png"><img src="./images/pin.png"></br>
            <img src="./images/pin.png"><img src="./images/pin.png"><img src="./images/pin.png"><img
                src="./images/pin.png">
            <button id="start_bt" onClick="start()">Start</button>
            <button id="game_theme1">인물</button>
            <button id="game_theme2">음식</button>
            <input type="text">
            <div type="text" value="30" id="timer"></div>
        </div>
    </div>
</body>

</html>